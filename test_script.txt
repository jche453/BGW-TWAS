
################## Save Genotype

time ${bfGWAS_SS_dir}/bin/Estep_mcmc \
-vcf ${bfGWAS_SS_dir}/1KG_example/ExData/vcfs/CFH_REGION_1KG.vcf.gz \
-p ${bfGWAS_SS_dir}/1KG_example/ExData/phenoAMD_1KG.txt \
-a ${bfGWAS_SS_dir}/1KG_example/ExData/annos/Anno_CFH_REGION_1KG.gz \
-fcode ${bfGWAS_SS_dir}/1KG_example/ExData/AnnoCode6.txt \
-hfile ${bfGWAS_SS_dir}/1KG_example/Test_Wkdir/hypval.current \
-GTfield GT -bvsrm -maf 0.005 -win 100 -smin 0 -smax 5 -w 10 -s 10 \
-o CFH_REGION_1KG -saveGeno


######################### Test on 1KG Example Data
bfGWAS_SS_dir="/net/fantasia/home/yjingj/GIT/bfGWAS_SS"
test_dir="/net/fantasia/home/yjingj/GIT/bfGWAS_SS/1KG_example/Test_Wkdir"

cd $test_dir

## Save Annotation file in the format of chr/pos/ref/alt/func
zcat ${bfGWAS_SS_dir}/1KG_example/ExData/vcfs/CFH_REGION_1KG.vcf.gz | awk '{print $1"\t"$2"\t"$4"\t"$5}' > Anno_CFH_REGION_1KG.temp

zcat Anno_CFH_REGION_1KG.gz | cut -f4 > Anno_CFH_REGION_1KG.tempFunc

paste Anno_CFH_REGION_1KG.temp Anno_CFH_REGION_1KG.tempFunc > Anno_CFH_REGION_1KG.txt

### Run bfGWAS_SS with individual level data
time ${bfGWAS_SS_dir}/bin/Estep_mcmc \
-vcf ${bfGWAS_SS_dir}/1KG_example/ExData/vcfs/CFH_REGION_1KG.vcf.gz \
-p ${bfGWAS_SS_dir}/1KG_example/ExData/phenoAMD_1KG.txt \
-a ${bfGWAS_SS_dir}/1KG_example/ExData/annos/Anno_CFH_REGION_1KG.txt.gz \
-fcode ${bfGWAS_SS_dir}/1KG_example/ExData/AnnoCode6.txt \
-hfile ${bfGWAS_SS_dir}/1KG_example/Test_Wkdir/hypval.current \
-GTfield GT -bvsrm -maf 0.005 -win 100 -smin 0 -smax 5 -w 50000 -s 50000 \
-o CFH_REGION_1KG_SS -initype 3 -LDwindow 500000 -seed 2017 \
-saveSS \
> ${test_dir}/test_SS.output.txt &

real    2m1.698s
user    2m0.211s
sys     0m0.925s


################## Read score.txt and cov.txt files 

bfGWAS_SS_dir="/net/fantasia/home/yjingj/GIT/bfGWAS_SS"
test_dir="/net/fantasia/home/yjingj/GIT/bfGWAS_SS/1KG_example/Test_Wkdir"

cd $test_dir

### Run bfGWAS_SS with summary level data

time ${bfGWAS_SS_dir}/bin/Estep_mcmc \
-score ${bfGWAS_SS_dir}/1KG_example/Test_Wkdir/output/CFH_REGION_1KG_SS.score.txt \
-cov ${bfGWAS_SS_dir}/1KG_example/Test_Wkdir/output/CFH_REGION_1KG_SS.cov.txt \
-n 2504 -rv 0.250064 -inputSS \
-a ${bfGWAS_SS_dir}/1KG_example/ExData/annos/Anno_CFH_REGION_1KG.txt.gz \
-fcode ${bfGWAS_SS_dir}/1KG_example/ExData/AnnoCode6.txt \
-hfile ${bfGWAS_SS_dir}/1KG_example/Test_Wkdir/hypval.current \
-GTfield GT -bvsrm -maf 0.005 -win 100 -smin 0 -smax 5 -w 50000 -s 50000 \
-o CFH_REGION_1KG_ReadSS -initype 3 -seed 2017 > ${test_dir}/ReadSS_test.output.txt &

real    0m9.315s
user    0m9.074s
sys     0m0.217s


######################### Test on AMD data 
bfGWAS_SS_dir="/net/fantasia/home/yjingj/GIT/bfGWAS_SS"
test_dir="/net/fantasia/home/yjingj/GIT/bfGWAS_SS/1KG_example/Test_Wkdir"

## Convert Annotation file
zcat ${test_dir}/amd_chr1_test.vcf.gz | awk 'NF>10{print $1"\t"$2"\t"$4"\t"$5}' > Anno_amd_chr1_test.temp
zcat Anno_amd_chr1_test.gz | cut -f4 > Anno_amd_chr1_test.tempFunc
paste Anno_amd_chr1_test.temp Anno_amd_chr1_test.tempFunc > Anno_amd_chr1_test.txt

###### Test on a sub amd dataset
## Using individual level data
time ${bfGWAS_SS_dir}/bin/Estep_mcmc -vcf ${test_dir}/amd_chr1_test.vcf.gz -p /net/wonderland/home/yjingj/AMD/amd_pheno_scaled.txt.gz -a ${test_dir}/Anno_amd_chr1_test.txt -fcode /net/wonderland/home/yjingj/AMD/AnnoPartition/FuncAnno5.txt -hfile /net/wonderland/home/yjingj/AMD/AMD_Results/GVS_anno5/hypval.current -GTfield EC -maf 0.005 -bvsrm -rmin 1 -rmax 1 -smin 0 -smax 10 -win 100 -o amd_test_SS -w 50000 -s 50000 -initype 3 -rv 1 -LDwindow 500000 \
> ${test_dir}/AMDtest_SS.output.txt &

-saveSS -zipSS > ${test_dir}/AMDtest_SS.output.txt &

real    11m45.266s
user    11m37.865s
sys     0m1.263s

## Read SS 
time ${bfGWAS_SS_dir}/bin/Estep_mcmc \
-score ${test_dir}/output/amd_test_SS.score.txt.gz \
-cov ${test_dir}/output/amd_test_SS.cov.txt.gz \
-n 33976 -rv 1 -inputSS \
-a ${test_dir}/Anno_amd_chr1_test.txt \
-fcode /net/wonderland/home/yjingj/AMD/AnnoPartition/FuncAnno5.txt \
-hfile /net/wonderland/home/yjingj/AMD/AMD_Results/GVS_anno5/hypval.current \
-bvsrm -rmin 1 -rmax 1 -smin 0 -smax 10 -win 100 \
-o amd_test_ReadSS -w 50000 -s 50000 -initype 3 \
> ${test_dir}/AMDtest_ReadSS.output.txt &



############ Memory usage : 438MB ; computation time :

bfGWAS_SS_dir="/net/fantasia/home/yjingj/GIT/bfGWAS_SS"
test_dir="/net/wonderland/home/yjingj/AMD/Test_bfGWAS_SS"

~/Scripts/Shell_Script/ConvertAnnoFile.sh /net/wonderland/home/yjingj/Data/AMD_Imputed_Filtered/chr1_Loci_1_sub1.vcf.gz /net/wonderland/home/yjingj/Data/AMD/GVS_Annotation chr1_Loci_1_sub1 

time ${bfGWAS_SS_dir}/bin/Estep_mcmc \
-vcf /net/wonderland/home/yjingj/Data/AMD_Imputed_Filtered/chr1_Loci_1_sub1.vcf.gz \
-p /net/wonderland/home/yjingj/AMD/amd_pheno_scaled.txt.gz \
-a /net/wonderland/home/yjingj/Data/AMD/GVS_Annotation/Anno_chr1_Loci_1_sub1.txt.gz \
-fcode /net/wonderland/home/yjingj/AMD/AnnoPartition/FuncAnno5.txt \
-hfile /net/wonderland/home/yjingj/AMD/AMD_Results/GVS_anno5/hypval.current \
-GTfield EC -maf 0.005 -bvsrm -rmin 1 -rmax 1 -smin 0 -smax 10 -win 100 \
-o amd_chr1_Loci_1_sub1_SS -w 50000 -s 50000 -initype 3 -rv 1 -LDwindow 500000 \
-saveSS -zipSS > ${test_dir}/amd_chr1_Loci_1_sub1_SS.output.txt &

> ${test_dir}/AMDtest_SS.output.txt &

# bfGWAS Memory usage : 116MB ; computation time : 
real    11m22.967s
user    11m18.258s
sys     0m1.113s

## Read SS 
time ${bfGWAS_SS_dir}/bin/Estep_mcmc \
-score ${test_dir}/output/amd_chr1_Loci_1_sub1_SS.score.txt.gz \
-cov ${test_dir}/output/amd_chr1_Loci_1_sub1_SS.cov.txt.gz \
-n 33976 -rv 1 -inputSS \
-a ${test_dir}/Anno_chr1_Loci_1_sub1.txt.gz \
-fcode /net/wonderland/home/yjingj/AMD/AnnoPartition/FuncAnno5.txt \
-hfile /net/wonderland/home/yjingj/AMD/AMD_Results/GVS_anno5/hypval.current \
-bvsrm -rmin 1 -rmax 1 -smin 0 -smax 10 -win 100 \
-o amd_chr1_Loci_1_sub1_ReadSS -w 50000 -s 50000 -initype 3 \
> ${test_dir}/amd_chr1_Loci_1_sub1_ReadSS.output.txt &

## bfGWAS Memory usage : 438MB ; computation time : 

bfGWAS_dir="/net/fantasia/home/yjingj/GIT/bfGWAS"
test_dir="/net/wonderland/home/yjingj/AMD/Test_bfGWAS_SS"

time ${bfGWAS_dir}/bin/Estep_mcmc -vcf /net/wonderland/home/yjingj/Data/AMD_Imputed_Filtered/chr1_Loci_1_sub1.vcf.gz -p /net/wonderland/home/yjingj/AMD/amd_pheno_scaled.txt.gz -a /net/wonderland/home/yjingj/Data/AMD/GVS_Annotation/Anno_chr1_Loci_1_sub1.gz -fcode /net/wonderland/home/yjingj/AMD/AnnoPartition/FuncAnno5.txt -hfile /net/wonderland/home/yjingj/AMD/AMD_Results/GVS_anno5/hypval.current -GTfield EC -maf 0.005 -bvsrm -rmin 1 -rmax 1 -smin 0 -smax 10 -win 100 -o amd_test -w 50000 -s 50000 -initype 3 -rv 1 > ${test_dir}/amd_test.output.txt &



###### profiling new model for AMD all genotype data

gprof -p -b ${GMGIT}/bin/gemma_newmodel_pg gmon.out > AMD_allgeno_gprof.txt
gprof -p -b ${GMGIT}/bin/gemma_newmodel_pg gmon.out > AMD_test_gprof.txt

###### Convert all AMD Anno files

cat /net/wonderland/home/yjingj/Data/AMD/GVS_Annotation/vcf_filehead_withSubLoci.txt | while read file 
do
	echo $file
	~/Scripts/Shell_Script/ConvertAnnoFile.sh /net/wonderland/home/yjingj/Data/AMD_Imputed_Filtered/${file}.vcf.gz /net/wonderland/home/yjingj/Data/AMD/GVS_Annotation ${file} 
done






